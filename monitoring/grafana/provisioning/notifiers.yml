apiVersion: 1

notifiers:
  - name: slack-critical-alerts
    type: slack
    uid: slack-critical
    org_id: 1
    is_default: false
    send_reminder: true
    disable_resolve_message: false
    frequency: "5m"
    settings:
      url: "${SLACK_WEBHOOK_URL}"
      username: "Grafana Alerts"
      icon_emoji: ":warning:"
      recipient: "#alerts-critical"
      title: "[{{ .Status | toUpper }}] {{ .AlertName }}"
      text: |
        **Alert:** {{ .AlertName }}
        **Severity:** {{ .Labels.severity }}
        **Component:** {{ .Labels.component }}
        **Status:** {{ .Status }}
        
        **Description:**
        {{ .Annotations.description }}
        
        **Impact:**
        {{ .Annotations.impact }}
        
        **Runbook:** {{ .Annotations.runbook_url }}
        **Dashboard:** {{ .Annotations.dashboard_url }}
        
        **Time:** {{ .StartsAt }}

  - name: slack-warning-alerts
    type: slack
    uid: slack-warning
    org_id: 1
    is_default: false
    send_reminder: true
    disable_resolve_message: false
    frequency: "15m"
    settings:
      url: "${SLACK_WEBHOOK_URL}"
      username: "Grafana Alerts"
      icon_emoji: ":large_orange_diamond:"
      recipient: "#alerts-warnings"
      title: "[{{ .Status | toUpper }}] {{ .AlertName }}"
      text: |
        **Alert:** {{ .AlertName }}
        **Severity:** {{ .Labels.severity }}
        **Component:** {{ .Labels.component }}
        **Status:** {{ .Status }}
        
        **Description:**
        {{ .Annotations.description }}
        
        **Runbook:** {{ .Annotations.runbook_url }}
        **Time:** {{ .StartsAt }}

  - name: email-oncall
    type: email
    uid: email-oncall
    org_id: 1
    is_default: false
    send_reminder: true
    disable_resolve_message: false
    frequency: "10m"
    settings:
      addresses: "${ONCALL_EMAIL_ADDRESSES}"
      singleEmail: false
    secure_settings:
      password: "${EMAIL_PASSWORD}"

  - name: email-platform-team
    type: email
    uid: email-platform
    org_id: 1
    is_default: false
    send_reminder: false
    disable_resolve_message: false
    frequency: "30m"
    settings:
      addresses: "${PLATFORM_TEAM_EMAIL}"
      singleEmail: true

  - name: console-logger
    type: webhook
    uid: console-logger
    org_id: 1
    is_default: true
    send_reminder: false
    disable_resolve_message: false
    settings:
      url: "http://localhost:5000/api/alert-webhook"
      httpMethod: "POST"
      maxAlerts: 10

deleteNotifiers:
  - name: old-slack-notifier
    uid: old-slack
    org_id: 1

contact_points:
  - name: default-contact-point
    receivers:
      - uid: console-logger
        type: webhook
        settings:
          url: "http://localhost:5000/api/alert-webhook"
          httpMethod: "POST"

  - name: critical-alerts-contact-point
    receivers:
      - uid: slack-critical
        type: slack
      - uid: email-oncall
        type: email
      - uid: console-logger
        type: webhook

  - name: warning-alerts-contact-point
    receivers:
      - uid: slack-warning
        type: slack
      - uid: email-platform
        type: email
      - uid: console-logger
        type: webhook

notification_policies:
  - receiver: default-contact-point
    group_by:
      - alertname
      - severity
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
    routes:
      - receiver: critical-alerts-contact-point
        matchers:
          - severity = critical
        group_wait: 10s
        group_interval: 5m
        repeat_interval: 1h
        continue: false

      - receiver: warning-alerts-contact-point
        matchers:
          - severity = warning
        group_wait: 1m
        group_interval: 10m
        repeat_interval: 4h
        continue: false
