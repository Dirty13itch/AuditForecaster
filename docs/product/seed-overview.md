# M/I Homes Twin Cities - Seed Data Overview

**Last Updated:** November 3, 2025  
**Purpose:** Comprehensive documentation of the seed data system for the Energy Audit field application, providing realistic test data for M/I Homes developments across the Twin Cities metro area.

---

## Overview

This document describes the seed data generated by `/scripts/seed-mi-homes.ts`. The seed script creates a complete, realistic dataset representing M/I Homes' energy auditing operations across five Twin Cities developments, including jobs, inspections, test results, QA data, and tax credit projects.

The seed data enables:
- **Development testing** with realistic field data
- **QA validation** of inspection workflows
- **UI/UX testing** with representative data volumes
- **Performance testing** under realistic load
- **Training** for new team members

---

## Summary Statistics

The seed script creates the following entities:

| Entity Type | Count | Description |
|------------|-------|-------------|
| **Organizations** | 1 | Ulrich Energy Auditing |
| **Users** | 3 | 1 Admin + 2 Field Inspectors |
| **Builders** | 1 | M/I Homes of Minnesota |
| **Builder Contacts** | 2 | Primary and secondary contacts |
| **Construction Managers** | 3 | Area manager, manager, superintendent |
| **Developments** | 5 | Twin Cities metro communities |
| **Plans** | 11 | Home floor plans (2-3 per development) |
| **Lots** | 50 | 10 lots per development |
| **Jobs** | 35 | 7 jobs per development |
| **Completed Jobs** | 15 | Jobs with full test data (43% completion rate) |
| **Blower Door Tests** | 15 | Air infiltration test results |
| **Duct Leakage Tests** | 15 | Total and outside duct leakage |
| **Ventilation Tests** | 15 | ASHRAE 62.2 compliance tests |
| **Forecasts** | 15 | Energy performance predictions |
| **Photos** | 15 | Field photo records (3 photos each on first 5 completed jobs) |
| **QA Inspection Scores** | 5 | Quality assurance reviews |
| **Tax Credit Projects** | 2 | 45L certification projects |

**Total Database Records:** ~170+ entities

---

## M/I Homes Developments

### Development Details

| # | Development Name | Municipality | Total Lots | Plans | Jobs Created |
|---|-----------------|--------------|------------|-------|--------------|
| 1 | **Rush Hollow North** | Maple Grove | 120 | 3 | 7 |
| 2 | **Valley Crest** | Shakopee | 85 | 2 | 7 |
| 3 | **Oneka Shores** | Hugo | 95 | 2 | 7 |
| 4 | **Amber Fields** | Rosemount | 65 | 2 | 7 |
| 5 | **Towns at Fox Creek** | Rogers | 75 | 2 | 7 |

**Total Lots Across All Developments:** 440  
**Active Seeded Lots:** 50 (10 per development)

### Floor Plans

Each development includes 2-3 floor plans with the following characteristics:

#### Rush Hollow North (Maple Grove)
- **Alexander** - 2,850 sq ft
- **Victoria** - 3,100 sq ft  
- **Camden** - 2,450 sq ft

#### Valley Crest (Shakopee)
- **Columbia** - 2,650 sq ft
- **Hudson** - 3,300 sq ft

#### Oneka Shores (Hugo)
- **Birchwood II** - 2,750 sq ft
- **Cedarwood** - 2,950 sq ft

#### Amber Fields (Rosemount)
- **Grayson** - 2,500 sq ft
- **Willow II** - 2,850 sq ft

#### Towns at Fox Creek (Rogers)
- **Savanna** - 2,350 sq ft
- **Victoria** - 2,650 sq ft

**Floor Area Range:** 2,350 - 3,300 sq ft  
**Average Floor Area:** 2,725 sq ft

---

## Jobs Distribution

### Jobs by Development

Each development has:
- **10 lots created** (numbered LOT-001 through LOT-010)
- **7 sold lots** with active jobs (lots 1-7)
- **3 available lots** (lots 8-10)

### Jobs by Status

| Status | Count | Percentage |
|--------|-------|------------|
| **Done** (completed with test data) | 15 | 43% |
| **Scheduled** (pending) | 20 | 57% |
| **Total** | 35 | 100% |

### Jobs by Inspection Type

The seed script randomly assigns one of three inspection types to each job:

| Inspection Type | Description |
|----------------|-------------|
| `qa_rough` | QA inspection at rough-in stage |
| `qa_final` | QA inspection at final stage |
| `hers_blower_door` | HERS blower door test |

**Note:** Inspection types are randomly distributed across all jobs.

---

## Example Job Records

Below are representative examples of the seeded job data:

### Example 1: Completed Job with Full Test Data
- **Development:** Rush Hollow North
- **Address:** 1001 Rush Hollow North Drive (Lot LOT-001)
- **Plan:** Alexander (2,850 sq ft)
- **Inspection Type:** qa_rough
- **Status:** Done
- **Inspector:** Field Inspector (rotates between 2 inspectors)
- **Construction Manager:** Randomly assigned from 3 CMs
- **Test Data:**
  - Blower Door: CFM50 ~1,200-1,700, ACH50 ~2.5-4.0
  - Duct Leakage: Total ~80-120 CFM25, Outside ~40-60 CFM25
  - Ventilation: 4 bedrooms, measured flows
  - Forecast: Predicted ACH50 2.8, TDL 4.0, DLO 2.0
- **Photos:** 3 photos with tags (exterior, HVAC, insulation, etc.)

### Example 2: Scheduled Job (Pending)
- **Development:** Valley Crest
- **Address:** 1005 Valley Crest Drive (Lot LOT-005)
- **Plan:** Hudson (3,300 sq ft)
- **Inspection Type:** hers_blower_door
- **Status:** Scheduled
- **Scheduled Date:** Random date within next 30 days
- **Test Data:** Not yet collected

### Example 3: Multi-Development Pattern
Jobs are evenly distributed across developments with 3 completed jobs per development (first 3 of 7 jobs in each development are marked as "done" with full test data).

---

## Test Data Characteristics

### Blower Door Tests (15 completed)
- **House Volume:** Calculated as floor area Ã— 8 ft ceiling height
- **Conditioned Area:** Matches plan floor area
- **Number of Stories:** 2
- **Basement Type:** Conditioned
- **CFM50 Range:** 1,200 - 1,700 (random variation)
- **ACH50 Range:** 2.5 - 4.0 (random variation)
- **Test Time:** 10:00 AM

### Duct Leakage Tests (15 completed)
- **Test Type:** Both (total and outside)
- **System Type:** Forced air
- **Conditioned Area:** Matches plan floor area
- **Total Duct Leakage (CFM25):** 80 - 120 (random)
- **Leakage to Outside (CFM25):** 40 - 60 (random)
- **Test Time:** 11:00 AM

### Ventilation Tests (15 completed)
- **Floor Area:** Matches plan floor area
- **Bedrooms:** 4 (standardized)
- **Test Time:** 12:00 PM
- **Compliance:** ASHRAE 62.2 calculations

### Forecasts (15 completed)
- **Wall Insulation:** R-21
- **Ceiling Insulation:** R-49
- **Windows U-Factor:** 0.28
- **AC SEER:** 16
- **Furnace AFUE:** 96%
- **Predicted ACH50:** 2.8
- **Predicted TDL:** 4.0 CFM25/100 sq ft
- **Predicted DLO:** 2.0 CFM25/100 sq ft
- **Foundation Type:** Slab

---

## Photo Records

### Photo Coverage
- **Total Photos:** 15 total across all jobs
- **Jobs with Photos:** First 5 completed jobs only (3 photos each)
- **Completed Jobs WITHOUT Photos:** 10 completed jobs (no photos)
- **Average Photos per Job with Photos:** 3

**Note:** Out of 15 total completed jobs, only the first 5 receive photo documentation (15 photos total = 5 jobs Ã— 3 photos). The remaining 10 completed jobs have test data but no photos.

### Photo Tags (Random Assignment)
Photos are tagged with realistic field categories:
- `exterior_front` - Front elevation
- `exterior_back` - Rear elevation  
- `hvac_equipment` - HVAC systems
- `ductwork` - Duct installation
- `insulation_attic` - Attic insulation
- `windows_exterior` - Window installation
- `foundation` - Foundation details
- `garage` - Garage area

### Photo Metadata
- **File Path:** `photos/job_{jobId}_photo_{n}.jpg`
- **Thumbnail Path:** `photos/thumbnails/job_{jobId}_photo_{n}.jpg`
- **Full URL:** Cloud storage URLs
- **Captions:** Auto-generated descriptions

---

## QA Inspection Scores

### QA Data (5 records)
QA inspection scores are created for randomly selected completed jobs:

| Field | Value/Range |
|-------|-------------|
| **Total Score** | 85 - 99 (high quality) |
| **Max Score** | 100 |
| **Percentage** | Matches total score |
| **Grade** | A (â‰¥90), B (80-89), C (<80) |
| **Inspector** | Field Inspector 1 (primary reviewer) |
| **Review Notes** | Auto-generated per job |

**Distribution:**
- Expected grades: Mostly A's and B's (scores 85-99)
- No failing grades in seed data

---

## Tax Credit Projects

### 45L Projects (2 records)

#### Project 1: Rush Hollow North Certification
- **Project Name:** 2024 ENERGY STAR Certification - Rush Hollow North
- **Project Type:** Single-family
- **Tax Year:** 2024
- **Total Units:** 25
- **Qualified Units:** 25 (100% qualified)
- **Status:** Certified

#### Project 2: Valley Crest Certification  
- **Project Name:** 2024 ENERGY STAR Certification - Valley Crest
- **Project Type:** Single-family
- **Tax Year:** 2024
- **Total Units:** 18
- **Qualified Units:** 16 (89% qualified)
- **Status:** Pending

---

## Organization & User Data

### Organization
- **Name:** Ulrich Energy Auditing
- **RESNET Cert:** RESNET-123456
- **Email:** info@ulrichenergy.com
- **Phone:** (612) 555-2000
- **Address:** 123 Energy St, Minneapolis, MN 55401
- **Service Areas:** Twin Cities Metro, Greater Minnesota

### Users

| Role | Count | Details |
|------|-------|---------|
| **Admin** | 1 | admin@ulrichenergy.com / password123 |
| **Field Inspector** | 2 | inspector1@ulrichenergy.com, inspector2@ulrichenergy.com / password123 |

**Login Credentials:** All users use password `password123`

### Construction Managers (3)
1. **Mike Anderson** - Area Construction Manager
   - Email: manderson@mihomes.com
   - Phone: (612) 555-1001

2. **Sarah Johnson** - Construction Manager
   - Email: sjohnson@mihomes.com
   - Phone: (612) 555-1002

3. **Tom Peterson** - Superintendent
   - Email: tpeterson@mihomes.com
   - Phone: (612) 555-1003

---

## Known Data Patterns & Anomalies

### Intentional Patterns

1. **Job Distribution**
   - Each development has exactly 7 jobs
   - First 3 jobs (per development) are completed with full test data
   - Last 4 jobs are scheduled (pending)

2. **Lot Status**
   - Lots 1-7: Sold (with jobs)
   - Lots 8-10: Available (no jobs)

3. **Inspector Assignment**
   - Jobs alternate between Inspector 1 and Inspector 2
   - Even-indexed jobs â†’ Inspector 1
   - Odd-indexed jobs â†’ Inspector 2

4. **Test Data Randomization**
   - CFM50, ACH50, duct leakage values are randomized within realistic ranges
   - Ensures variability for testing purposes

5. **Scheduled Dates**
   - Random dates within next 30 days from seed execution
   - Provides mix of upcoming and near-term jobs

### Test Validation Cases

The seed data intentionally includes scenarios for validation:

- **Normal Cases:** Most jobs have typical test values
- **High Performance:** Some houses with low ACH50 (2.5-3.0)
- **Code Compliance:** TDL and DLO values within Minnesota 2020 code limits
- **QA High Scores:** Most QA scores are 85-99 (A/B grades)

---

## Data Health Metrics

### Completion Rates
- **Job Completion:** 43% (15 of 35 jobs done)
- **Test Data Coverage:** 100% of completed jobs have full test suite
- **Photo Coverage:** 33% (5 of 15 completed jobs)
- **QA Review Coverage:** 33% (5 of 15 completed jobs)

### Data Integrity
- âœ… All jobs linked to valid lots, plans, builders
- âœ… All completed jobs have test data (blower door, duct, ventilation, forecast)
- âœ… All tests linked to valid jobs
- âœ… All users, builders, CMs properly referenced
- âœ… No orphaned records

### Referential Integrity
```
Organization (1)
  â””â”€â”€ Users (3)
  â””â”€â”€ Builder (1)
       â”œâ”€â”€ Builder Contacts (2)
       â”œâ”€â”€ Construction Managers (3)
       â”œâ”€â”€ Developments (5)
       â”‚    â”œâ”€â”€ Plans (11 total)
       â”‚    â”œâ”€â”€ Lots (50 total)
       â”‚    â””â”€â”€ Jobs (35 total)
       â”‚         â”œâ”€â”€ Test Data (15 jobs)
       â”‚         â”œâ”€â”€ Photos (15 photos on 5 jobs)
       â”‚         â””â”€â”€ QA Scores (5 reviews)
       â””â”€â”€ Tax Credit Projects (2)
```

---

## Usage Instructions

### Running the Seed Script

Execute the seed script from the project root:

```bash
tsx scripts/seed-mi-homes.ts
```

### Expected Output

The script will output progress indicators:
```
ðŸŒ± Starting M/I Homes Twin Cities seed...
âœ… Organization created: Ulrich Energy Auditing
âœ… Users created: 3
âœ… Builder created: M/I Homes
âœ… Builder contacts created: 2
âœ… Construction managers created: 3
âœ… Developments created...
   ðŸ“ Development: Rush Hollow North (Maple Grove)
   ðŸ“ Plans created: 3
   ðŸ˜ï¸ Lots created: 10
   ðŸ“‹ Jobs created: 7
âœ… Total jobs created: 35
âœ… Total visits with test data: 15
âœ… Photos created: 15
âœ… QA inspection scores created: 5
âœ… 45L tax credit projects created: 2
ðŸŽ‰ Seed completed successfully!
```

### Prerequisites

- Database must be accessible (DATABASE_URL configured)
- All schema migrations must be applied
- No conflicting data (script will fail on unique constraint violations)

### Re-running the Seed

To re-run the seed script:
1. **Clear existing data** (truncate tables or reset database)
2. **Run migrations** to ensure schema is current
3. **Execute seed script** as shown above

### Database Cleanup (if needed)

```sql
TRUNCATE TABLE qa_inspection_scores CASCADE;
TRUNCATE TABLE photos CASCADE;
TRUNCATE TABLE forecasts CASCADE;
TRUNCATE TABLE ventilation_tests CASCADE;
TRUNCATE TABLE duct_leakage_tests CASCADE;
TRUNCATE TABLE blower_door_tests CASCADE;
TRUNCATE TABLE tax_credit_projects CASCADE;
TRUNCATE TABLE jobs CASCADE;
TRUNCATE TABLE lots CASCADE;
TRUNCATE TABLE plans CASCADE;
TRUNCATE TABLE developments CASCADE;
TRUNCATE TABLE construction_managers CASCADE;
TRUNCATE TABLE builder_contacts CASCADE;
TRUNCATE TABLE builders CASCADE;
TRUNCATE TABLE users CASCADE;
TRUNCATE TABLE organizations CASCADE;
```

---

## Development & Testing Use Cases

### Use Case 1: UI Development
- Test job lists, filters, search across 35 jobs
- Verify pagination with realistic data volumes
- Test plan/lot/development dropdowns

### Use Case 2: Inspection Workflows
- Complete scheduled jobs â†’ done status
- Add test data to scheduled jobs
- Upload photos to completed jobs
- Generate reports from completed jobs

### Use Case 3: QA Validation
- Review completed jobs with test data
- Create QA inspection scores
- Flag jobs for re-inspection

### Use Case 4: Tax Credit Processing
- Review qualified homes
- Generate 45L documentation
- Track certification status

### Use Case 5: Builder Portal
- View jobs by development
- Access test results and reports
- Track project progress

---

## Notes for Developers

### Schema Dependencies
The seed script depends on the following schema tables:
- `organizations`, `users`
- `builders`, `builderContacts`, `constructionManagers`
- `developments`, `lots`, `plans`
- `jobs`, `photos`
- `blowerDoorTests`, `ductLeakageTests`, `ventilationTests`, `forecasts`
- `qaInspectionScores`
- `taxCreditProjects`

### Field Mappings
Key field naming conventions:
- Developments: `municipality` (not city), `totalLots` (not lot_count)
- Plans: `planName` (not name), `floorArea` (not sqft)
- Lots: `streetAddress` (not address), `lotNumber` (not number)
- Jobs: `inspectionType` (enum), `name` (required), `contractor` (required)
- Tests: All have `testDate` and `testTime` fields

### Randomization
The script uses `crypto.randomUUID()` for IDs and Math.random() for test values, ensuring unique data on each run while maintaining realistic distributions.

---

**Document Version:** 1.0  
**Script Version:** scripts/seed-mi-homes.ts (Nov 2025)  
**Last Verified:** November 3, 2025
